<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù¾ÛŒØ´Ø®ÙˆØ§Ù† Ø¬Ø§Ù…Ø¹ Ø¯ÙˆØ±Ù‡ Ù†Ø¸Ø§Ù… Ø§Ù†Ø¯ÛŒØ´Ù‡</title>
    
    <!-- ÙÙˆÙ†Øª -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet"/>
    
    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ¨â€ŒØ§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† -->
    <script src="https://developer.eitaa.com/eitaa-web-app.js"></script>

    <style>
        :root {
            --bg: hsl(189, 90%, 8%);
            --card: #1e293b;
            --white-gold: hsl(0, 0%, 94%);
            --teal: #14b8a6;
            --text: #f8fafc;
            --disabled: #334155;
            --watched: #064e3b;
            --special-bg: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            --special-border: #f59e0b;
        }
        
        body { 
            font-family: 'Vazirmatn', sans-serif; 
            background-color: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 60px 10px 20px 10px;
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
        }


        #app-container { display: none; }

        /* --- Ù‡Ø¯Ø± Ùˆ Ù„ÙˆÚ¯ÙˆÙ‡Ø§ --- */
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--white-gold);
        }

        .logos-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .logo-box {
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
        }
        
        .logo-box:hover { transform: scale(1.05); }

        .logo-box img {
            max-height: 75px;
            width: auto;
            object-fit: contain;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.1));
        }

        h1 { 
            color: var(--white-gold); 
            margin: 0 0 8px 0; 
            font-size: 1.4rem;
            text-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
        }

        /* --- Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡â€ŒÙ‡Ø§ --- */
        .section-divider {
            width: 100%;
            margin: 20px 0 10px 0;
            text-align: center;
        }

        .section-divider img {
            max-width: 100%;
            height: auto;
            max-height: 85px;
            object-fit: contain;
            border-radius: 10px;
        }
        
        .divider-fallback {
            color: var(--white-gold);
            font-size: 1.1rem;
            font-weight: bold;
            border-bottom: 1px solid var(--teal);
            padding-bottom: 8px;
            display: inline-block;
        }

        .shelf-container { margin-bottom: 15px; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* --- Ø¬Ù„Ø³Ø§Øª ÙˆÛŒÚ˜Ù‡ --- */
        .special-session-container {
            max-width: 800px;
            margin: 15px auto;
        }

        .special-card {
            background: var(--special-bg);
            border: 2px solid var(--special-border);
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 15px;
            position: relative;
        }
        
        .special-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
            background: linear-gradient(90deg, transparent, var(--special-border), transparent);
        }

        .special-img {
            width: 100%;
            max-width: 250px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }

        .special-content { width: 100%; }
        
        .special-title {
            font-size: 1.2rem;
            color: var(--special-border);
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .special-btn {
            background: var(--special-border);
            color: #000;
            font-weight: bold;
            display: block;
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            text-decoration: none;
            transition: transform 0.2s;
            font-size: 0.9rem;
            cursor: pointer; /* Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ø´Ø§Ù†Ú¯Ø± Ù…ÙˆØ³ */
        }
        
        .special-btn:hover { transform: scale(1.02); box-shadow: 0 0 15px var(--special-border); }
        
        .special-btn.disabled {
            background: var(--disabled);
            color: #94a3b8;
            cursor: default;
            box-shadow: none;
            transform: none;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ Intro Ú©ÙˆÚ†Ú© */
        .intro-compact-card {
            display: flex;
            flex-direction: row;
            align-items: center;
            padding: 10px;
            gap: 15px;
            text-align: right;
        }

        .intro-compact-card .special-img {
            max-width: 90px;
            max-height: 90px;
            margin-bottom: 0;
            object-fit: cover;
        }

        .intro-compact-card .special-title {
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .intro-compact-card .special-desc {
            font-size: 0.8rem;
            margin-bottom: 8px;
            display: block;
        }

        .intro-compact-card .special-btn {
            padding: 8px 15px;
            font-size: 0.8rem;
            width: auto;
            display: inline-block;
        }

        /* Ø¯Ú©Ù…Ù‡ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ø¬Ø¯Ø¯ */
        .rewatch-btn {
            background: transparent;
            border: 1px solid var(--special-border);
            color: var(--special-border);
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-size: 0.85rem;
            display: inline-block;
            transition: all 0.3s;
            cursor: pointer;
        }
        .rewatch-btn:hover {
            background: rgba(245, 158, 11, 0.1);
        }

        /* --- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¹Ù…ÙˆÙ„ÛŒ --- */
        .card {
            background: var(--card);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            position: relative;
            min-width: 260px; 
        }

        .card:hover { 
            transform: translateY(-5px); 
            border-color: var(--white-gold); 
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .card-img-container {
            width: 100%;
            height: 135px;
            background: #0f172a;
            border-bottom: 2px solid var(--white-gold);
            overflow: hidden;
        }

        .card-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
        .card:hover .card-img { transform: scale(1.05); }

        .card-body { padding: 12px; flex-grow: 1; display: flex; flex-direction: column; }
        
        .card-title {
            font-weight: 800;
            font-size: 1rem;
            margin-bottom: 12px;
            color: var(--white-gold);
            text-align: center;
        }

        .card.grayscale-mode .card-img { filter: grayscale(100%); opacity: 0.5; }
        .card.grayscale-mode .card-title { color: #94a3b8; }
        .card.grayscale-mode { border-color: #334155; }

        .ep-list { display: flex; flex-direction: column; gap: 7px; }

        .btn {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 9px 10px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.8rem;
            transition: all 0.2s;
            position: relative;
            cursor: pointer;
        }

        .btn-info { display: flex; align-items: center; gap: 6px; }
        .time-badge { font-size: 0.7rem; background: rgba(0,0,0,0.3); padding: 1px 5px; border-radius: 4px; color: #cbd5e1; font-family: 'Vazirmatn', sans-serif; }
        
        .btn-active { background: rgba(20, 184, 166, 0.1); color: var(--teal); border: 1px solid var(--teal); }
        .btn-active:hover { background: var(--teal); color: #fff; }
        
        .btn-watched { background: var(--watched); color: #a7f3d0; border: 1px solid #059669; }
        .btn-watched:hover { background: #047857; }
        .btn-watched::after { content: 'âœ“'; position: absolute; left: 8px; font-weight: bold; }
        
        .btn-disabled { background: var(--disabled); color: #94a3b8; cursor: default; opacity: 0.6; border: 1px solid transparent; }
        
        .coming-soon-overlay { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; color: #64748b; padding: 15px 0; background: rgba(255,255,255,0.02); border-radius: 10px; border: 1px dashed #334155; }
        .coming-soon-icon { font-size: 1.8rem; margin-bottom: 8px; opacity: 0.5; }

        /* --- Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ø®ØµÙˆØµ Ù…ÙˆØ¨Ø§ÛŒÙ„ --- */
        @media (max-width: 768px) {
            .grid {
                display: flex;
                overflow-x: auto;
                padding-bottom: 20px;
                gap: 15px;
                scroll-snap-type: x mandatory;
                scrollbar-width: none; 
            }
            .grid::-webkit-scrollbar { display: none; }
            
            .card {
                scroll-snap-align: center;
                min-width: 85%;
            }

            .special-card.intro-compact-card { flex-direction: row; }
            .special-card { flex-direction: column; }
            .section-divider img { max-height: 50px; }
        }
        
        @media (min-width: 769px) {
            .special-card { flex-direction: row; text-align: right; gap: 20px; }
            .special-title { text-align: right; }
            .special-btn { width: auto; display: inline-block; padding: 10px 40px; }
        }

        .footer { text-align: center; margin-top: 50px; color: #64748b; font-size: 0.75rem; padding: 20px; }
    </style>
</head>
<body>

    <!-- Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§ØµÙ„ÛŒ -->
    <div id="app-container">
        
        <header>
            <div class="logos-container">
                <div class="logo-box"><img src="logo/Ù…Ø£ÙˆØ§_Ø§ØµÙ„ÛŒ_Ø³ÙÛŒØ¯_luyk.png" alt="Ù„ÙˆÚ¯Ùˆ Ù…Ø£ÙˆØ§"></div>
                <div class="logo-box"><img src="logo/Ø¯ÙˆØ±Ù‡.png" alt="Ù„ÙˆÚ¯Ùˆ Ø¯ÙˆØ±Ù‡"></div>
                <div class="logo-box"><img src="logo/Ù…Ø¹Ø±ÙØªÛŒ.png" alt="Ù„ÙˆÚ¯Ùˆ Û³"></div>
            </div>
            <h1> Ø¯ÙˆØ±Ù‡ Ø¬Ø§Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù†Ø¯ÛŒØ´Ù‡ Ø§Ø³Ù„Ø§Ù…ÛŒ</h1>
            <p style="color:#94a3b8; font-size:0.85rem;">Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹ Ø¨Ù‡ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ</p>
        </header>

        <div id="intro-container"></div>
        <div class="section-divider" id="div-mabani"></div>
        <div class="shelf-container"><div class="grid" id="mabani-root"></div></div>
        <div class="section-divider" id="div-nezamat"></div>
        <div class="shelf-container"><div class="grid" id="nezamat-root"></div></div>
        <div class="section-divider" id="div-tatbighat"></div>
        <div class="shelf-container"><div class="grid" id="tatbighat-root"></div></div>
        <div id="outro-container"></div>

        <div class="footer">Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø¬Ù‡Øª Ø³Ù‡ÙˆÙ„Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø·Ù„Ø§Ø¨ Ùˆ Ù¾Ú˜ÙˆÙ‡Ø´Ú¯Ø±Ø§Ù† Ù…Ø­ØªØ±Ù…</div>

    </div>

    <script>
        // ============================================================
        // ğŸš€ ØªØ§Ø¨Ø¹ Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ (Ù‚Ù„Ø¨ ØªØºÛŒÛŒØ±Ø§Øª Ø¬Ø¯ÛŒØ¯)
        // ============================================================
        function openDeepLink(url) {
            // Ø§Ú¯Ø± Ø¯Ø± Ù…Ø­ÛŒØ· Ø§ÛŒØªØ§ Ùˆ Ù…ØªØ¯ Ù…Ø®ØµÙˆØµ Ø¢Ù† Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯
            if (window.Eitaa && window.Eitaa.WebApp && typeof window.Eitaa.WebApp.openEitaaLink === 'function') {
                window.Eitaa.WebApp.openEitaaLink(url);
            } 
            // Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†ØŒ Ø§Ú¯Ø± ØªÙ„Ú¯Ø±Ø§Ù… Ø¨ÙˆØ¯ (Ú†ÙˆÙ† Ú¯Ø§Ù‡ÛŒ Ø§ÛŒØªØ§ Ø¨Ø§ Ù†Ø§Ù… ØªÙ„Ú¯Ø±Ø§Ù… Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
            else if (window.Telegram && window.Telegram.WebApp && typeof window.Telegram.WebApp.openTelegramLink === 'function' && url.includes('t.me')) {
                window.Telegram.WebApp.openTelegramLink(url);
            }
            // Ø­Ø§Ù„Øª fallback Ø¨Ø±Ø§ÛŒ Ù…Ø­ÛŒØ·â€ŒÙ‡Ø§ÛŒ ØªØ³Øª ÛŒØ§ Ø§Ú¯Ø± Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ú©Ø§Ø± Ù†Ú©Ø±Ø¯
            else {
                window.open(url, '_blank');
            }
        }

        // ============================================================
        // ğŸš€ Ù„Ø§Ø¬ÛŒÚ© ØªÙ…Ø§Ù… ØµÙØ­Ù‡ Ùˆ ØªØ´Ø®ÛŒØµ Ø§ÛŒØªØ§/ØªÙ„Ú¯Ø±Ø§Ù…
        // ============================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            const errorOverlay = document.getElementById('eitaa-only-overlay');
            const appContainer = document.getElementById('app-container');
            const WebApp = window.Telegram?.WebApp || window.Eitaa?.WebApp;

            if (!WebApp) {
                console.warn('No WebApp detected. Access denied.');
                return; 
            }

            errorOverlay.style.display = 'none';
            appContainer.style.display = 'block';
            WebApp.ready();

            // Ù…Ù†Ø·Ù‚ ØªÙ…Ø§Ù… ØµÙØ­Ù‡
            try {
                if (WebApp.isVersionAtLeast && WebApp.isVersionAtLeast('8.0')) {
                    WebApp.requestFullscreen();
                } else if (WebApp.expand) {
                    WebApp.expand();
                }
            } catch (e) {
                try { WebApp.expand(); } catch (err) {}
            }
        });

        // ============================================================
        // ğŸ›  Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØªÙˆØ§
        // ============================================================

        const introSession = {
            title: "Ø¬Ù„Ø³Ù‡ Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ: Ø¢Ø´Ù†Ø§ÛŒÛŒ",
            image: "pic/Ø¢Ø´Ù†Ø§ÛŒÛŒ.jpg",
            link: "https://eitaa.com/link_moghaddame",
            desc: "Ú†Ø±Ø§ Ø¨Ù‡ Ù…Ù†Ø¸ÙˆÙ…Ù‡ ÙÚ©Ø±ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒÙ…ØŸ"
        };

        const outroSession = {
            title: "Ø¬Ù„Ø³Ù‡ Ù¾Ø§ÛŒØ§Ù†ÛŒ: Ø¬Ù…Ø¹â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ø¸Ø§Ù…â€ŒÙ…Ù†Ø¯",
            image: "pic/Ø¬Ù…Ø¹.jpg",
            link: "", 
            desc: "Ù…Ø±ÙˆØ± Ú©Ù„Ø§Ù† Ù…Ø¨Ø§Ø­Ø« Ùˆ ØªØ±Ø³ÛŒÙ… Ø¯Ø±Ø®ØªÙˆØ§Ø±Ù‡ Ù†Ù‡Ø§ÛŒÛŒ"
        };

        const separators = {
            mabani: "pic/Ù…Ø¨Ø§Ù†ÛŒ.png",
            nezamat: "pic/Ù†Ø¸Ø§Ù…Ø§Øª.png",
            tatbighat: "pic/ØªØ·Ø¨ÛŒÙ‚Ø§Øª.png"
        };

        const allChapters = [
            // 1 ØªØ§ 5: Ù…Ø¨Ø§Ù†ÛŒ
            { 
                title: "Û±. Ù…Ø¨Ø§Ù†ÛŒ Ù…Ø¹Ø±ÙØªâ€ŒØ´Ù†Ø§Ø³Ø§Ù†Ù‡", 
                image: "pic/Ù…Ø¹Ø±ÙØª.png", 
                episodes: [
                    { link: "https://eitaa.com/nezam_andisheh", time: "15:30" }, 
                    { link: "https://eitaa.com/example2", time: "22:10" }, 
                    { link: "", time: "" }, 
                    { link: "", time: "" }
                ] 
            },
            { title: "Û². Ù…Ø¨Ø§Ù†ÛŒ Ù‡Ø³ØªÛŒâ€ŒØ´Ù†Ø§Ø³Ø§Ù†Ù‡", image: "pic/Ù‡Ø³ØªÛŒ.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            { title: "Û³. Ù…Ø¨Ø§Ù†ÛŒ Ø§Ù†Ø³Ø§Ù†â€ŒØ´Ù†Ø§Ø³Ø§Ù†Ù‡", image: "pic/Ø§Ù†Ø³Ø§Ù†.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            { title: "Û´. Ù…Ø¨Ø§Ù†ÛŒ Ø¬Ø§Ù…Ø¹Ù‡â€ŒØ´Ù†Ø§Ø³Ø§Ù†Ù‡", image: "pic/Ø¬Ø§Ù…Ø¹Ù‡.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            { title: "Ûµ. Ù…Ø¨Ø§Ù†ÛŒ Ø¯ÛŒÙ†â€ŒØ´Ù†Ø§Ø³Ø§Ù†Ù‡", image: "pic/Ø¯ÛŒÙ†.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            
            // 6 ØªØ§ 10: Ù†Ø¸Ø§Ù…Ø§Øª
            { title: "Û¶. Ù†Ø¸Ø§Ù… Ø²Ù†Ø¯Ú¯ÛŒ ÙØ±Ø¯ Ø¯Ø± Ø§Ø³Ù„Ø§Ù…", image: "pic/ÙØ±Ø¯.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            { title: "Û·. Ù†Ø¸Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø¯Ø± Ø§Ø³Ù„Ø§Ù…", image: "pic/Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            { title: "Û¸. Ù†Ø¸Ø§Ù… Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ ÙØ±Ù‡Ù†Ú¯ Ø¯Ø± Ø§Ø³Ù„Ø§Ù…", image: "pic/ÙØ±Ù‡Ù†Ú¯.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            { title: "Û¹. Ù†Ø¸Ø§Ù… Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ø³ÛŒØ§Ø³Øª Ø¯Ø± Ø§Ø³Ù„Ø§Ù…", image: "pic/Ø³ÛŒØ§Ø³Øª.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            { title: "Û±Û°. Ù†Ø¸Ø§Ù… Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ø§Ù‚ØªØµØ§Ø¯ Ø¯Ø± Ø§Ø³Ù„Ø§Ù…", image: "pic/Ø§Ù‚ØªØµØ§Ø¯.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            
            // 11 ØªØ§ 15: ØªØ·Ø¨ÛŒÙ‚Ø§Øª
            { title: "Û±Û±. ØªØ§Ø±ÛŒØ® Ø§Ø³Ù„Ø§Ù…", image: "pic/ØªØ§Ø±ÛŒØ®.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            { title: "Û±Û². Ø¬Ø±ÛŒØ§Ù† Ø±ÙˆØ´Ù†ÙÚ©Ø±ÛŒ Ø¯Ø± Ø§ÛŒØ±Ø§Ù†", image: "pic/Ø¬Ø±ÛŒØ§Ù†.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            { title: "Û±Û³. Ù…Ø¹Ù†ÙˆÛŒØª Ø§Ø³Ù„Ø§Ù…ÛŒ Ùˆ Ù…Ø¹Ù†ÙˆÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù†ÙˆÙ¾Ø¯ÛŒØ¯", image: "pic/Ù…Ø¹Ù†ÙˆÛŒØª.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            { title: "Û±Û´. Ø±Ø³Ø§Ù†Ù‡ Ùˆ Ø¬Ù†Ú¯ Ø´Ù†Ø§Ø®ØªÛŒ", image: "pic/Ø±Ø³Ø§Ù†Ù‡.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] },
            { title: "Û±Ûµ. Ø¢ÛŒÙ†Ø¯Ù‡ ØªÙ…Ø¯Ù†ÛŒ Ø¨Ø´Ø±", image: "pic/Ø¢ÛŒÙ†Ø¯Ù‡.jpg", episodes: [{ link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }, { link: "", time: "" }] }
        ];

        // ============================================================
        // â›”ï¸ Ù…ÙˆØªÙˆØ± Ø±Ù†Ø¯Ø±ÛŒÙ†Ú¯
        // ============================================================
        
        const getWatchedList = () => JSON.parse(localStorage.getItem('watchedEpisodes')) || [];
        const saveWatched = (id) => {
            const list = getWatchedList();
            if (!list.includes(id)) { list.push(id); localStorage.setItem('watchedEpisodes', JSON.stringify(list)); }
        };

        function getPlaceholder(index) {
            const colors = ['115e59', '0f766e', '0e7490', '0369a1', '1d4ed8', '7e22ce', 'be123c'];
            return `https://placehold.co/600x400/${colors[index % colors.length]}/ffffff?text=Fasl+${index + 1}`;
        }

        function toPersianNum(n) {
            const farsiDigits = ['Û°', 'Û±', 'Û²', 'Û³', 'Û´', 'Ûµ', 'Û¶', 'Û·', 'Û¸', 'Û¹'];
            return n.toString().replace(/\d/g, x => farsiDigits[x]);
        }

        function createCard(chapter, globalIndex) {
            const card = document.createElement('div');
            const isChapterEmpty = chapter.episodes.every(ep => ep.link.trim() === "");
            
            card.className = isChapterEmpty ? 'card grayscale-mode' : 'card';
            
            const imgUrl = chapter.image.trim() === "" ? getPlaceholder(globalIndex) : chapter.image;
            
            let contentHtml = '';
            if (isChapterEmpty) {
                contentHtml = `<div class="coming-soon-overlay"><div class="coming-soon-icon">â³</div><div>Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...</div></div>`;
            } else {
                contentHtml = '<div class="ep-list">';
                chapter.episodes.forEach((ep, epIndex) => {
                    const uniqueId = `${globalIndex}-${epIndex}`;
                    const isWatched = getWatchedList().includes(uniqueId);
                    const sessionNum = toPersianNum(epIndex + 1); 
                    
                    if (ep.link.trim() !== "") {
                        const btnClass = isWatched ? 'btn btn-watched' : 'btn btn-active';
                        const label = isWatched ? 'âœ“' : 'Ù…Ø´Ø§Ù‡Ø¯Ù‡';
                        
                        // ØªØºÛŒÛŒØ±: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² openDeepLink Ø¯Ø± onclick
                        contentHtml += `<a href="javascript:void(0);" class="${btnClass}" onclick="openDeepLink('${ep.link}'); markAsWatched('${uniqueId}', this); return false;">
                                <div class="btn-info"><span>ğŸ¥ Ø¬Ù„Ø³Ù‡ ${sessionNum}</span>${ep.time ? `<span class="time-badge">${ep.time}</span>` : ''}</div><span>${label}</span></a>`;
                    } else {
                        contentHtml += `<div class="btn btn-disabled"><span>ğŸ”’ Ø¬Ù„Ø³Ù‡ ${sessionNum}</span><span>...</span></div>`;
                    }
                });
                contentHtml += '</div>';
            }
            card.innerHTML = `<div class="card-img-container"><img src="${imgUrl}" alt="${chapter.title}" class="card-img"></div>
                              <div class="card-body"><div class="card-title">${chapter.title}</div>${contentHtml}</div>`;
            return card;
        }

        function renderSpecialSession(containerId, data, isIntro = false) {
            const container = document.getElementById(containerId);
            
            if (isIntro && localStorage.getItem('intro_watched') === 'true') {
                container.innerHTML = `
                    <div style="text-align: center; margin: 20px auto;">
                        <a href="javascript:void(0);" onclick="openDeepLink('${data.link}'); return false;" class="rewatch-btn">
                           ğŸ”„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ø¬Ø¯Ø¯ Ø¬Ù„Ø³Ù‡ Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ
                        </a>
                    </div>`;
                return;
            }

            const cardClass = isIntro ? 'special-card intro-compact-card' : 'special-card';
            const descHtml = isIntro ? `<span class="special-desc">${data.desc}</span>` : `<p style="color:#ccc; margin-bottom:15px;">${data.desc}</p>`;

            let btnHtml = '';
            let imgStyle = '';
            
            if (data.link) {
                const introLogic = isIntro ? `localStorage.setItem('intro_watched', 'true'); setTimeout(()=>location.reload(), 1000);` : '';
                // ØªØºÛŒÛŒØ±: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² openDeepLink Ùˆ ØªØ±Ú©ÛŒØ¨ Ø¨Ø§ Ù„Ø§Ø¬ÛŒÚ© Ù…Ù‚Ø¯Ù…Ù‡
                btnHtml = `<a href="javascript:void(0);" class="special-btn" onclick="openDeepLink('${data.link}'); ${introLogic} return false;">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¬Ù„Ø³Ù‡ ÙˆÛŒÚ˜Ù‡</a>`;
            } else {
                btnHtml = `<div class="special-btn disabled">ğŸ”’ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...</div>`;
                imgStyle = 'filter: grayscale(100%); opacity: 0.7;';
            }

            container.innerHTML = `
                <div class="special-session-container">
                    <div class="${cardClass}">
                        <img src="${data.image}" class="special-img" alt="${data.title}" style="${imgStyle}">
                        <div class="special-content">
                            <div class="special-title">ğŸŒŸ ${data.title}</div>
                            ${descHtml}
                            ${btnHtml}
                        </div>
                    </div>
                </div>`;
        }

        function renderDivider(id, imageUrl, fallbackText) {
            const el = document.getElementById(id);
            if (imageUrl) el.innerHTML = `<img src="${imageUrl}" alt="${fallbackText}">`;
            else el.innerHTML = `<div class="divider-fallback">${fallbackText}</div>`;
        }

        renderSpecialSession('intro-container', introSession, true);
        renderSpecialSession('outro-container', outroSession, false);
        
        renderDivider('div-mabani', separators.mabani, 'Ù…Ø¨Ø§Ù†ÛŒ Ù†Ø¸Ø±ÛŒ');
        renderDivider('div-nezamat', separators.nezamat, 'Ù†Ø¸Ø§Ù…Ø§Øª Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ');
        renderDivider('div-tatbighat', separators.tatbighat, 'ØªØ·Ø¨ÛŒÙ‚Ø§Øª Ø¹ØµØ±ÛŒ');

        const mabaniRoot = document.getElementById('mabani-root');
        const nezamatRoot = document.getElementById('nezamat-root');
        const tatbighatRoot = document.getElementById('tatbighat-root');

        allChapters.forEach((chapter, index) => {
            const card = createCard(chapter, index);
            if (index < 5) mabaniRoot.appendChild(card);
            else if (index < 10) nezamatRoot.appendChild(card);
            else tatbighatRoot.appendChild(card);
        });

        function markAsWatched(id, element) {
            saveWatched(id);
            element.classList.remove('btn-active');
            element.classList.add('btn-watched');
        }

    </script>
</body>
</html>
